# データベース管理ツール

これは、PythonとStreamlitを使用して開発されたデータベース管理ツールです。
PostgreSQLデータベースへの接続、テーブル情報（テーブル一覧、カラム一覧）の表示、カラムマッピングの定義と保存（SQLite使用）、データ移行、および単一レコードのINSERT機能を提供します。

## 主な機能

- **データベース接続:**
    - PostgreSQLデータベースへの接続設定と接続テスト。
    - カラムマッピングや接続情報などのメタデータを保存するためのSQLiteデータベースへの接続。
- **データベース情報表示:**
    - 接続したデータベースのテーブル一覧を表示。
    - 選択したテーブルのカラム名とデータ型を表示。
- **カラムマッピング:**
    - ソーステーブルとターゲットテーブル（同一DBまたは異なるDB間も想定）のカラム同士の関連付けを定義。
    - 定義したマッピング設定に名前を付けてSQLiteに保存、読み込み、削除。
- **データ移行:**
    - 保存されたカラムマッピングに基づいて、ソーステーブルからターゲットテーブルへデータを移行。
    - チャンクサイズを指定して大規模データにも対応（Pandas経由）。
- **INSERT文発行:**
    - 選択したテーブルのカラムに基づいて入力フォームを動的に生成。
    - 入力されたデータに基づいてINSERT文を生成し、確認後に実行。

## 技術スタック

- Python 3.9+
- Streamlit (GUI)
- SQLAlchemy (データベース操作の抽象化)
- psycopg2-binary (PostgreSQLアダプタ)
- Pandas (データ移行時のデータ操作)

## セットアップ方法

1.  **リポジトリのクローン:**
    ```bash
    git clone <リポジトリURL>
    cd <リポジトリ名>
    ```

## 仮想環境のセットアップ (venv)

1.  **Pythonのインストール確認:**
    このプロジェクトでは Python 3.12 以上を推奨します。ターミナルで以下のコマンドを実行して、Pythonのバージョンを確認してください。
    ```bash
    python --version
    # または
    python3 --version
    ```
    Pythonがインストールされていない場合、またはバージョンが古い場合は、[Python公式サイト](https://www.python.org/)からダウンロードしてインストールしてください。

2.  **仮想環境の作成:**
    プロジェクトのルートディレクトリで、以下のコマンドを実行して仮想環境を作成します。`.venv` は仮想環境のディレクトリ名です。
    ```bash
    python -m venv .venv
    ```

3.  **仮想環境のアクティベート:**
    作成した仮想環境をアクティベートします。
    -   **Windows (コマンドプロンプト):**
        ```bash
        .venv\Scripts\activate
        ```
    -   **Windows (PowerShell):**
        ```bash
        .venv\Scripts\Activate.ps1
        ```
    -   **macOS / Linux (bash/zsh):**
        ```bash
        source .venv/bin/activate
        ```
    アクティベートされると、プロンプトの先頭に `(.venv)` のように表示されます。

4.  **依存関係のインストール:**
    仮想環境がアクティベートされた状態で、以下のコマンドを実行して必要なライブラリをインストールします。
    ```bash
    pip install -r requirements.txt
    ```

4.  **PostgreSQLデータベースの準備:**
    - このツールで接続するPostgreSQLデータベースが稼働していることを確認してください。
    - 必要に応じて、テスト用のデータベース、ユーザー、テーブルを作成してください。

## 使用方法

1.  **Streamlitアプリケーションの起動:**
    プロジェクトルートディレクトリで以下のコマンドを実行します。
    ```bash
    python -m streamlit run app.py
    ```
    これにより、Webブラウザでアプリケーションが開きます。

2.  **メタデータDBへの接続:**
    - サイドバーの「メタデータDB (SQLite)」セクションで、SQLiteデータベースファイルのパスを指定します（例: `metadata.db`）。
    - 「メタデータDB接続テスト/接続」ボタンをクリックして接続します。初回接続時には、必要なテーブルが自動的に作成されます。

3.  **接続先データベースの設定:**
    - メインエリアの「接続先データベース」セクションにあるタブ「接続1 (ソース/ターゲット)」および「接続2 (ターゲットDB - 任意)」を使用します。
    - **接続1:** データ移行のソースDB、または単一DB操作（INSERTなど）のターゲットDBとして設定します。
    - **接続2:** データ移行のターゲットDBとして設定します。
    - それぞれのフォームにPostgreSQLの接続情報（ホスト、ポート、データベース名、ユーザー名、パスワード）を入力し、「接続テスト/接続」ボタンをクリックします。

4.  **データベース情報の確認:**
    - 接続に成功すると、「データベース情報」セクションにテーブル一覧が表示されます。
    - テーブルを選択すると、そのテーブルのカラム情報（名前、型）が表示されます。

5.  **カラムマッピングの設定:**
    - 「カラムマッピング設定」セクションで行います。
    - **前提:** メタデータDBと「接続1 (ソース)」が接続され、ソーステーブルが選択されている必要があります。データ移行の場合は「接続2 (ターゲット)」も接続し、ターゲットテーブルを選択します。
    - **マッピング作成:** ソースカラムに対応するターゲットカラムをドロップダウンから選択します。「このマッピングを適用」で現在の設定を内部状態に反映します。
    - **保存:** マッピング名を入力し、「現在のマッピングを保存」ボタンでSQLiteに保存します。
    - **読み込み/削除:** 保存済みのマッピングを選択し、対応するボタンで操作します。

6.  **データ操作:**
    - 「データ操作」セクションで行います。
    - **データ移行:**
        - **前提:** ソースDB、ターゲットDBが接続され、テーブルが選択され、カラムマッピングが適用されている必要があります。
        - 移行設定を確認し、チャンクサイズを指定して「データ移行実行」ボタンをクリックします。
    - **単一レコードのINSERT:**
        - **前提:** 「接続1 (ソースDB)」が接続され、テーブルが選択されている必要があります。
        - 選択されたテーブルのカラムに基づいて入力フォームが表示されます。
        - データを入力し、「INSERT文生成と実行」ボタンをクリックすると、まず生成されるSQL文が表示されます。
        - 確認後、「このINSERT文を実行する」ボタンで実際にレコードを挿入します。

## 今後の拡張案

- 他のデータベース（MySQL, SQL Serverなど）への対応。
- データ型のより厳密なマッピングとバリデーション。
- データ移行時のターゲットテーブルクリアオプション。
- 複数レコードの一括INSERT機能（CSVアップロードなど）。
- SQLクエリエディタと実行機能。
- より詳細なログ機能。
- ユーザー認証機能。

## 注意事項

- パスワードなどの機密情報は適切に管理してください。このツールはローカルでの使用を想定しています。
- 大量データの移行や複雑な操作を行う前に、必ずテスト環境で十分に検証し、データのバックアップを取得してください。
```
